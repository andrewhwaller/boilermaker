# frozen_string_literal: true

require "test_helper"

class FileUploadComponentTest < ActiveSupport::TestCase
  include Phlex::Testing::ViewHelper

  test "renders file upload with default options" do
    component = Components::FileUpload.new(name: "user[avatar]")
    html = render(component)

    assert_includes html, 'name="user[avatar]"'
    assert_includes html, 'data-controller="upload"'
    assert_includes html, "Drop file here"
  end

  test "renders file upload with accept filter" do
    component = Components::FileUpload.new(name: "user[avatar]", accept: "image/*")
    html = render(component)

    assert_includes html, 'accept="image/*"'
    assert_includes html, "Accepts: image/*"
  end

  test "renders file upload with multiple enabled" do
    component = Components::FileUpload.new(name: "user[documents][]", multiple: true)
    html = render(component)

    assert_includes html, "multiple"
    assert_includes html, "Drop files here"
  end

  test "renders file upload with custom label" do
    component = Components::FileUpload.new(name: "user[avatar]", label: "Upload your photo")
    html = render(component)

    assert_includes html, "Upload your photo"
  end
end

class FilePreviewComponentTest < ActiveSupport::TestCase
  include Phlex::Testing::ViewHelper

  # Note: These tests require fixtures with actual attachments
  # In a real application, you would set up attachments in the test setup

  test "returns nothing when no attachment" do
    component = Components::FilePreview.new(attachment: nil)
    html = render(component)

    assert_empty html.strip
  end
end

class FileListComponentTest < ActiveSupport::TestCase
  include Phlex::Testing::ViewHelper

  test "renders empty state when no attachments" do
    component = Components::FileList.new(attachments: nil)
    html = render(component)

    assert_includes html, "No files uploaded"
  end
end
