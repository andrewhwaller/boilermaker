<div class="border-b border-base-300 pb-2">
 <div class="flex items-center justify-between">
 <h1 class="font-bold text-base-content uppercase ">CONFIGURE SYSTEM</h1>
 <div class="flex gap-2">
 <%= link_to "RETURN", main_app.root_path, class: "btn btn-sm" %>
 <%= link_to "REVERT", boilermaker.settings_path, class: "btn btn-sm" %>
 <button type="submit" form="settings_form" class="btn btn-sm btn-primary">PERSIST</button>
 </div>
 </div>
</div>

<div class="bg-base-300/40 border border-base-300 px-3 py-2 flex items-center gap-2">
 <div class="w-1 h-1 bg-primary rounded-full animate-pulse"></div>
 <span class="text-base-content/80 text-xs">APPLICATION SERVER WILL BE RESTARTED AFTER CONFIG CHANGES</span>
</div>

<%= form_with url: boilermaker.settings_path, method: :patch, local: true, scope: :settings, id: "settings_form" do |form| %>
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
 <!-- LEFT COLUMN: APPLICATION & THEMES -->
 <div class="space-y-3">
 <!-- APPLICATION -->
 <div class="bg-base-200 border border-base-300">
 <div class="bg-base-300/40 border-b border-base-300 px-3 py-1">
 <h2 class="text-xs font-bold text-base-content uppercase ">APPLICATION</h2>
 </div>
 <div class="p-3">
 <%= form.fields_for :app do |app_form| %>
 <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
 <div>
 <%= app_form.label :name, "NAME", class: "text-xs text-base-content/70 font-bold" %>
 <%= app_form.text_field :name,  value: @settings.dig('app', 'name') || 'Boilermaker',  class: "input input-bordered w-full",
 placeholder: "App name" %>
 </div>
  <div>
 <%= app_form.label :version, "VERSION", class: "text-xs text-base-content/70 font-bold" %>
 <%= app_form.text_field :version,  value: @settings.dig('app', 'version') || '1.0.0',  class: "input input-bordered w-full",
 placeholder: "1.0.0" %>
 </div>
  <div class="md:col-span-2">
 <%= app_form.label :support_email, "SUPPORT", class: "text-xs text-base-content/70 font-bold" %>
 <%= app_form.email_field :support_email,  value: @settings.dig('app', 'support_email') || 'support@example.com',  class: "input input-bordered w-full",
 placeholder: "support@example.com" %>
 </div>
  <div class="md:col-span-2">
 <%= app_form.label :description, "DESCRIPTION", class: "text-xs text-base-content/70 font-bold" %>
 <%= app_form.text_area :description,  value: @settings.dig('app', 'description') || 'A modern Rails application',  class: "input input-bordered w-full",
 rows: 2,
 placeholder: "Brief description" %>
 </div>
 </div>
 <% end %>
 </div>
 </div>

 <!-- THEMES -->
 <div class="bg-base-200 border border-base-300">
 <div class="bg-base-300/40 border-b border-base-300 px-3 py-1">
 <h2 class="text-xs font-bold text-base-content uppercase ">THEMES</h2>
 </div>
 <div class="p-3">
 <%= form.fields_for :ui do |ui_form| %>
 <%= ui_form.fields_for :theme do |theme_form| %>
 <% builtins_light = Boilermaker::Themes::LIGHT %>
 <% builtins_dark = Boilermaker::Themes::DARK %>
 <% custom_light = Boilermaker::Themes::CUSTOM_LIGHT.map { |n| ["#{n} (custom)", n] } %>
 <% custom_dark = Boilermaker::Themes::CUSTOM_DARK.map { |n| ["#{n} (custom)", n] } %>
 <% grouped_light = [
 ["Custom", custom_light],
 ["Light (built-in)", builtins_light.sort.map { |n| [n, n] }]
 ] %>
 <% grouped_dark = [
 ["Custom", custom_dark],
 ["Dark (built-in)", builtins_dark.sort.map { |n| [n, n] }]
 ] %>

 <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
 <div>
 <%= theme_form.label :light, "LIGHT", class: "text-xs text-base-content/70 font-bold" %>
 <%= theme_form.select :light,
 grouped_options_for_select(grouped_light, @settings.dig('ui', 'theme', 'light') || 'work-station'),
 {},
 class: "select select-bordered w-full" %>
 </div>

 <div>
 <%= theme_form.label :dark, "DARK", class: "text-xs text-base-content/70 font-bold" %>
 <%= theme_form.select :dark,
 grouped_options_for_select(grouped_dark, @settings.dig('ui', 'theme', 'dark')),
 {},
 class: "select select-bordered w-full" %>
 </div>
 </div>
 <% end %>

 <!-- NAVIGATION LAYOUT -->
 <%= ui_form.fields_for :navigation do |nav_form| %>
 <div class="mt-4 pt-3 border-t border-base-300/40">
 <div>
 <%= nav_form.label :layout_mode, "LAYOUT MODE", class: "text-xs text-base-content/70 font-bold" %>
 <%= nav_form.select :layout_mode,
 options_for_select([["Navbar (horizontal)", "navbar"], ["Sidebar (vertical)", "sidebar"]], @settings.dig('ui', 'navigation', 'layout_mode') || 'navbar'),
 {},
 class: "select select-bordered w-full" %>
 </div>
 </div>
 <% end %>

 <!-- TYPOGRAPHY -->
 <%= ui_form.fields_for :typography do |typo_form| %>
 <div class="mt-4 pt-3 border-t border-base-300/40">
 <div>
 <%= typo_form.label :font, "TYPEFACE", class: "text-xs text-base-content/70 font-bold" %>
 <% font_options = Boilermaker::FontConfiguration::FONTS.map do |_, config|
 label = config[:display_name] || config[:name]
 label += " (local)" if config[:type] == :local
 [label, config[:name]]
 end %>
 <%= typo_form.select :font,
 options_for_select(
 font_options,
 @settings.dig('ui', 'typography', 'font') || 'CommitMono'
),
 {},
 class: "select select-bordered w-full" %>
 </div>
 <div class="mt-3 flex items-center justify-between p-2 border border-base-300 bg-base-300/20">
 <span class="text-xs text-base-content/70">UPPERCASE TEXT</span>
 <%= typo_form.check_box :uppercase,
 { checked: @settings.dig('ui', 'typography', 'uppercase') != false, class: "toggle toggle-primary toggle-sm", id: "toggle_ui_uppercase" },
 "true", "false" %>
 </div>
 <div class="mt-3">
 <%= typo_form.label :size, "BASE FONT SIZE", class: "text-xs text-base-content/70 font-bold" %>
 <% size_options = [["Dense", "dense"], ["Base", "base"], ["Expanded", "expanded"]] %>
 <%= typo_form.select :size,
 options_for_select(
 size_options,
 @settings.dig('ui', 'typography', 'size') || 'base'
),
 {},
 class: "select select-bordered w-full" %>
 </div>
 </div>
 <% end %>
 <% end %>

 <p class="text-xs text-base-content/60 bg-base-300/30 px-2 py-1 mt-3 border-l border-base-300/50">
 Custom themes always available; built-ins included at build time only
 </p>
 </div>
 </div>
 </div>

 <!-- RIGHT COLUMN: FEATURES -->
 <div>
 <div class="bg-base-200 border border-base-300">
 <div class="bg-base-300/40 border-b border-base-300 px-3 py-1">
 <h2 class="text-xs font-bold text-base-content uppercase ">FEATURES</h2>
 </div>
 <div class="p-3">
 <%= form.fields_for :features do |features_form| %>
 <div class="grid grid-cols-1 gap-2">
 <div class="flex items-center justify-between p-2 border border-base-300/50">
 <span class="text-xs text-base-content uppercase">USER REGISTRATION</span>
 <%= features_form.check_box :user_registration,  { checked: @features['user_registration'] == true, class: "toggle toggle-primary toggle-sm", id: "toggle_user_registration" },  "true", "false" %>
 </div>
  <div class="flex items-center justify-between p-2 border border-base-300/50">
 <span class="text-xs text-base-content uppercase">PASSWORD RESET</span>
 <%= features_form.check_box :password_reset,  { checked: @features['password_reset'] == true, class: "toggle toggle-primary toggle-sm", id: "toggle_password_reset" },  "true", "false" %>
 </div>
  <div class="flex items-center justify-between p-2 border border-base-300/50">
 <span class="text-xs text-base-content uppercase">2FA</span>
 <%= features_form.check_box :two_factor_authentication,  { checked: @features['two_factor_authentication'] == true, class: "toggle toggle-primary toggle-sm", id: "toggle_two_factor_authentication" },  "true", "false" %>
 </div>
  <div class="flex items-center justify-between p-2 border border-base-300/50">
 <span class="text-xs text-base-content uppercase">MULTI TENANT</span>
 <%= features_form.check_box :multi_tenant,  { checked: @features['multi_tenant'] == true, class: "toggle toggle-primary toggle-sm", id: "toggle_multi_tenant" },  "true", "false" %>
 </div>
  <div class="flex items-center justify-between p-2 border border-base-300/50">
 <span class="text-xs text-base-content uppercase">PERSONAL ACCOUNTS</span>
 <%= features_form.check_box :personal_accounts,  { checked: @features['personal_accounts'] == true, class: "toggle toggle-primary toggle-sm", id: "toggle_personal_accounts" },  "true", "false" %>
 </div>
 </div>
 <% end %>
 </div>
 </div>

 </div>
 </div>
 <% end %>
