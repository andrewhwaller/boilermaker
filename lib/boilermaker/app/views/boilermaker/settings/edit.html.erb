<div class="border-b border-primary/30 pb-2">
  <div class="flex items-center justify-between">
    <h1 class="font-bold text-primary font-mono uppercase tracking-wider">CONFIGURE SYSTEM</h1>
    <div class="flex gap-2">
      <%= link_to "RETURN", main_app.root_path, class: "btn btn-sm btn-secondary font-mono" %>
      <%= link_to "REVERT", boilermaker.settings_path, class: "btn btn-sm btn-ghost text-error font-mono" %>
      <button type="submit" form="settings_form" class="btn btn-sm btn-success font-mono">PERSIST</button>
    </div>
  </div>
</div>

<div class="bg-warning/10 border border-warning/30 px-3 py-2 flex items-center gap-2">
  <div class="w-1 h-1 bg-warning rounded-full animate-pulse"></div>
  <span class="text-warning font-mono text-xs">APPLICATION SERVER WILL BE RESTARTED AFTER CONFIG CHANGES</span>
</div>

<%= form_with url: boilermaker.settings_path, method: :patch, local: true, scope: :settings, id: "settings_form" do |form| %>
  
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
    <!-- LEFT COLUMN: APPLICATION & THEMES -->
    <div class="space-y-3">
      <!-- APPLICATION -->
      <div class="bg-base-200 border border-base-300">
        <div class="bg-primary/20 border-b border-primary/30 px-3 py-1">
          <h2 class="text-xs font-bold text-primary uppercase tracking-wide font-mono">APPLICATION</h2>
        </div>
        <div class="p-3">
          <%= form.fields_for :app do |app_form| %>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <%= app_form.label :name, "NAME", class: "text-xs text-info font-mono font-bold" %>
                <%= app_form.text_field :name, 
                      value: @settings.dig('app', 'name') || 'Boilermaker', 
                      class: "input input-bordered w-full",
                      placeholder: "App name" %>
              </div>
              
              <div>
                <%= app_form.label :version, "VERSION", class: "text-xs text-info font-mono font-bold" %>
                <%= app_form.text_field :version, 
                      value: @settings.dig('app', 'version') || '1.0.0', 
                      class: "input input-bordered w-full",
                      placeholder: "1.0.0" %>
              </div>
              
              <div class="md:col-span-2">
                <%= app_form.label :support_email, "SUPPORT", class: "text-xs text-info font-mono font-bold" %>
                <%= app_form.email_field :support_email, 
                      value: @settings.dig('app', 'support_email') || 'support@example.com', 
                      class: "input input-bordered w-full",
                      placeholder: "support@example.com" %>
              </div>
              
              <div class="md:col-span-2">
                <%= app_form.label :description, "DESCRIPTION", class: "text-xs text-info font-mono font-bold" %>
                <%= app_form.text_area :description, 
                      value: @settings.dig('app', 'description') || 'A modern Rails application', 
                      class: "input input-bordered w-full",
                      rows: 2,
                      placeholder: "Brief description" %>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- THEMES -->
      <div class="bg-base-200 border border-base-300">
        <div class="bg-warning/20 border-b border-warning/30 px-3 py-1">
          <h2 class="text-xs font-bold text-warning uppercase tracking-wide font-mono">THEMES</h2>
        </div>
        <div class="p-3">
          <%= form.fields_for :ui do |ui_form| %>
            <%= ui_form.fields_for :theme do |theme_form| %>
              <% builtins_light = Boilermaker::Themes::LIGHT %>
              <% builtins_dark  = Boilermaker::Themes::DARK %>
              <% custom_light = [["work-station (custom)", "work-station"]] %>
              <% custom_dark  = [["graphite (custom)", "graphite"], ["command-center (custom)", "command-center"]] %>
              <% grouped_light = [
                ["Custom", custom_light],
                ["Light (built-in)", builtins_light.sort.map { |n| [n, n] }]
              ] %>
              <% grouped_dark = [
                ["Custom", custom_dark],
                ["Dark (built-in)", builtins_dark.sort.map { |n| [n, n] }]
              ] %>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                  <%= theme_form.label :light, "LIGHT", class: "text-xs text-warning font-mono font-bold" %>
                  <%= theme_form.select :light,
                        grouped_options_for_select(grouped_light, @settings.dig('ui', 'theme', 'light') || 'work-station'),
                        {},
                        class: "select select-bordered w-full" %>
                </div>

                <div>
                  <%= theme_form.label :dark, "DARK", class: "text-xs text-warning font-mono font-bold" %>
                  <%= theme_form.select :dark,
                        grouped_options_for_select(grouped_dark, @settings.dig('ui', 'theme', 'dark') || 'graphite'),
                        {},
                        class: "select select-bordered w-full" %>
                </div>
              </div>
            <% end %>

            <!-- NAVIGATION LAYOUT -->
            <%= ui_form.fields_for :navigation do |nav_form| %>
              <div class="mt-4 pt-3 border-t border-warning/20">
                <div>
                  <%= nav_form.label :layout_mode, "LAYOUT MODE", class: "text-xs text-warning font-mono font-bold" %>
                  <%= nav_form.select :layout_mode,
                        options_for_select([["Navbar (horizontal)", "navbar"], ["Sidebar (vertical)", "sidebar"]], @settings.dig('ui', 'navigation', 'layout_mode') || 'navbar'),
                        {},
                        class: "select select-bordered w-full" %>
                </div>
              </div>
            <% end %>
          <% end %>

          <p class="text-xs text-base-content/60 font-mono bg-base-300/30 px-2 py-1 mt-3 border-l border-warning/50">
            Custom themes always available; built-ins included at build time only
          </p>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN: FEATURES -->
    <div>
      <div class="bg-base-200 border border-base-300">
        <div class="bg-success/20 border-b border-success/30 px-3 py-1">
          <h2 class="text-xs font-bold text-success uppercase tracking-wide font-mono">FEATURES</h2>
        </div>
        <div class="p-3">
          <%= form.fields_for :features do |features_form| %>
            <div class="grid grid-cols-1 gap-2">
              <div class="flex items-center justify-between p-2 border border-base-300/50">
                <span class="text-xs font-mono text-base-content uppercase">USER REGISTRATION</span>
                <%= features_form.check_box :user_registration, 
                      { checked: @features['user_registration'] == true, class: "toggle toggle-success toggle-sm", id: "toggle_user_registration" }, 
                      "true", "false" %>
              </div>
              
              <div class="flex items-center justify-between p-2 border border-base-300/50">
                <span class="text-xs font-mono text-base-content uppercase">PASSWORD RESET</span>
                <%= features_form.check_box :password_reset, 
                      { checked: @features['password_reset'] == true, class: "toggle toggle-success toggle-sm", id: "toggle_password_reset" }, 
                      "true", "false" %>
              </div>
              
              <div class="flex items-center justify-between p-2 border border-base-300/50">
                <span class="text-xs font-mono text-base-content uppercase">2FA</span>
                <%= features_form.check_box :two_factor_authentication, 
                      { checked: @features['two_factor_authentication'] == true, class: "toggle toggle-success toggle-sm", id: "toggle_two_factor_authentication" }, 
                      "true", "false" %>
              </div>
              
              <div class="flex items-center justify-between p-2 border border-base-300/50">
                <span class="text-xs font-mono text-base-content uppercase">MULTI TENANT</span>
                <%= features_form.check_box :multi_tenant, 
                      { checked: @features['multi_tenant'] == true, class: "toggle toggle-success toggle-sm", id: "toggle_multi_tenant" }, 
                      "true", "false" %>
              </div>
              
              <div class="flex items-center justify-between p-2 border border-base-300/50">
                <span class="text-xs font-mono text-base-content uppercase">PERSONAL ACCOUNTS</span>
                <%= features_form.check_box :personal_accounts, 
                      { checked: @features['personal_accounts'] == true, class: "toggle toggle-success toggle-sm", id: "toggle_personal_accounts" }, 
                      "true", "false" %>
              </div>
            </div>
          <% end %>
        </div>
      </div>

    </div>
  </div>
  
<% end %>

