<style>
  /*
   * Settings form styles - uses variables from layouts/boilermaker.html.erb
   * which mirrors app/assets/tailwind/themes.css (Terminal dark polarity)
   */
  .prompt {
    color: var(--text-muted);
    margin-bottom: 4px;
    font-size: 11px;
  }

  .prompt::before {
    content: '$ ';
    color: var(--text);
  }

  .section {
    margin-bottom: 32px;
  }

  .section-header {
    color: var(--text-muted);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 8px;
    padding-bottom: 4px;
    border-bottom: 1px dashed var(--text-muted);
  }

  .section-header::before {
    content: '// ';
  }

  .warning-box {
    border: 1px solid var(--accent-muted);
    background: rgba(255, 176, 0, 0.05);
    padding: 12px;
    margin-bottom: 24px;
    font-size: 12px;
  }


  .warning-title {
    color: var(--accent);
    font-weight: 600;
    margin-bottom: 4px;
  }

  .warning-text {
    color: var(--text-muted);
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }

  .form-group {
    margin-bottom: 12px;
  }

  .form-group.full-width {
    grid-column: span 2;
  }

  .form-label {
    display: block;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 4px;
  }

  .form-input,
  .form-select,
  .form-textarea {
    width: 100%;
    background: var(--bg-alt);
    border: 1px solid var(--text-muted);
    color: var(--text);
    font-family: var(--font-mono);
    font-size: 13px;
    padding: 8px 10px;
    outline: none;
  }

  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    border-color: var(--text);
    box-shadow: 0 0 0 1px var(--glow);
  }

  .form-input::placeholder {
    color: var(--text-muted);
  }

  .form-select {
    cursor: pointer;
  }

  .form-select option {
    background: var(--bg-alt);
    color: var(--text);
  }

  .form-textarea {
    resize: vertical;
    min-height: 60px;
  }

  .form-toggle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    border: 1px dotted var(--text-muted);
    margin-bottom: 8px;
  }

  .form-toggle:hover {
    background: var(--glow);
  }

  .toggle-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text);
  }

  .toggle-checkbox {
    appearance: none;
    width: 40px;
    height: 20px;
    background: var(--bg-alt);
    border: 1px solid var(--text-muted);
    cursor: pointer;
    position: relative;
  }

  .toggle-checkbox::after {
    content: 'OFF';
    position: absolute;
    right: 4px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 8px;
    color: var(--text-muted);
  }

  .toggle-checkbox:checked {
    background: var(--text-muted);
    border-color: var(--text);
  }

  .toggle-checkbox:checked::after {
    content: 'ON';
    left: 4px;
    right: auto;
    color: var(--text);
  }

  .form-hint {
    font-size: 10px;
    color: var(--text-muted);
    margin-top: 4px;
    font-style: italic;
  }

  .form-hint::before {
    content: '# ';
  }

  .actions {
    display: flex;
    gap: 12px;
    padding-top: 16px;
    border-top: 1px solid var(--text-muted);
    margin-top: 24px;
  }

  .btn {
    font-family: var(--font-mono);
    font-size: 12px;
    padding: 8px 16px;
    border: 1px solid var(--text-muted);
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .btn:hover {
    border-color: var(--text);
    color: var(--text);
    background: var(--glow);
  }

  .btn-primary {
    background: var(--text-muted);
    border-color: var(--text);
    color: var(--bg);
  }

  .btn-primary:hover {
    background: var(--text);
    color: var(--bg);
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .config-row {
    display: grid;
    grid-template-columns: 130px 1fr;
    gap: 12px;
    padding: 6px 0;
    border-bottom: 1px dotted var(--text-muted);
    align-items: center;
    font-size: 12px;
  }

  .config-row:hover {
    background: var(--glow);
  }

  .config-key {
    color: var(--text-muted);
    text-transform: uppercase;
    font-size: 10px;
    letter-spacing: 0.05em;
  }

  .config-value {
    color: var(--text);
  }

  .theme-option {
    padding: 8px 10px;
    border: 1px dotted var(--text-muted);
    margin-bottom: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .theme-option:hover {
    background: var(--glow);
    border-color: var(--text);
  }

  .theme-option.selected {
    border-color: var(--text);
    border-style: solid;
  }

  .theme-option input[type="radio"] {
    display: none;
  }

  .theme-option .radio-indicator {
    width: 12px;
    height: 12px;
    border: 1px solid var(--text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
  }

  .theme-option.selected .radio-indicator {
    border-color: var(--text);
    color: var(--text);
  }

  .theme-option.selected .radio-indicator::after {
    content: '‚óè';
  }

  .theme-name {
    color: var(--text);
    font-size: 12px;
  }

  .theme-desc {
    color: var(--text-muted);
    font-size: 10px;
  }
</style>

<div data-controller="server-status" data-server-status-restart-url-value="<%= main_app.rails_health_check_path %>">
  <div class="warning-box">
    <div class="warning-title">SERVER WILL RESTART AFTER SAVING</div>
    <div class="warning-text" data-server-status-target="message">Changes require a server restart to take effect. Please wait for the restart to complete.</div>
  </div>

  <%= form_with url: boilermaker.settings_path, method: :patch, local: true, scope: :settings, id: "settings_form" do |form| %>

    <section class="section">
      <div class="section-header">Application</div>
      <%= form.fields_for :app do |app_form| %>
        <div class="form-grid">
          <div class="form-group">
            <%= app_form.label :name, "NAME", class: "form-label" %>
            <%= app_form.text_field :name, value: @settings.dig('app', 'name') || 'Boilermaker', class: "form-input", placeholder: "App name" %>
          </div>
          <div class="form-group">
            <%= app_form.label :version, "VERSION", class: "form-label" %>
            <%= app_form.text_field :version, value: @settings.dig('app', 'version') || '1.0.0', class: "form-input", placeholder: "1.0.0" %>
          </div>
          <div class="form-group full-width">
            <%= app_form.label :support_email, "SUPPORT EMAIL", class: "form-label" %>
            <%= app_form.email_field :support_email, value: @settings.dig('app', 'support_email') || 'support@example.com', class: "form-input", placeholder: "support@example.com" %>
          </div>
          <div class="form-group full-width">
            <%= app_form.label :description, "DESCRIPTION", class: "form-label" %>
            <%= app_form.text_area :description, value: @settings.dig('app', 'description') || 'A modern Rails application', class: "form-textarea", rows: 2, placeholder: "Brief description" %>
          </div>
        </div>
      <% end %>
    </section>

    <section class="section">
      <div class="section-header">Theme</div>
      <%= form.fields_for :ui do |ui_form| %>
        <%= ui_form.fields_for :theme do |theme_form| %>
          <% current_theme = @settings.dig('ui', 'theme', 'name') || 'paper' %>
          <% Boilermaker::Themes::AVAILABLE.each do |theme| %>
            <% metadata = Boilermaker::Themes.metadata_for(theme) %>
            <label class="theme-option <%= theme == current_theme ? 'selected' : '' %>">
              <%= theme_form.radio_button :name, theme, checked: theme == current_theme %>
              <span class="radio-indicator"></span>
              <span class="theme-name"><%= metadata[:name].upcase %></span>
              <span class="theme-desc">// <%= metadata[:description] %></span>
            </label>
          <% end %>
          <div class="form-hint">Users can toggle between light and dark polarity within the selected theme</div>
        <% end %>
      <% end %>
    </section>

    <section class="section">
      <div class="section-header">Navigation</div>
      <%= form.fields_for :ui do |ui_form| %>
        <%= ui_form.fields_for :navigation do |nav_form| %>
          <div class="form-group">
            <%= nav_form.label :layout_mode, "LAYOUT MODE", class: "form-label" %>
            <%= nav_form.select :layout_mode, options_for_select([["NAVBAR (HORIZONTAL)", "navbar"], ["SIDEBAR (VERTICAL)", "sidebar"]], @settings.dig('ui', 'navigation', 'layout_mode') || 'navbar'), {}, class: "form-select" %>
          </div>
        <% end %>
      <% end %>
    </section>

    <section class="section">
      <div class="section-header">Typography</div>
      <%= form.fields_for :ui do |ui_form| %>
        <%= ui_form.fields_for :typography do |typo_form| %>
          <div class="form-grid">
            <div class="form-group">
              <%= typo_form.label :font, "TYPEFACE", class: "form-label" %>
              <% font_options = Boilermaker::FontConfiguration::FONTS.map do |_, config|
                label = config[:display_name] || config[:name]
                label += " (local)" if config[:type] == :local
                [label.upcase, config[:name]]
              end %>
              <%= typo_form.select :font, options_for_select(font_options, @settings.dig('ui', 'typography', 'font') || 'CommitMono'), {}, class: "form-select" %>
            </div>
            <div class="form-group">
              <%= typo_form.label :size, "BASE SIZE", class: "form-label" %>
              <% size_options = [["DENSE", "dense"], ["BASE", "base"], ["EXPANDED", "expanded"]] %>
              <%= typo_form.select :size, options_for_select(size_options, @settings.dig('ui', 'typography', 'size') || 'base'), {}, class: "form-select" %>
            </div>
          </div>
          <div class="form-toggle">
            <span class="toggle-label">UPPERCASE UI TEXT</span>
            <input type="checkbox" name="settings[ui][typography][uppercase]" id="toggle_uppercase" value="true" <%= @settings.dig('ui', 'typography', 'uppercase') != false ? 'checked' : '' %> class="toggle-checkbox">
          </div>
        <% end %>
      <% end %>
    </section>

    <section class="section">
      <div class="section-header">Features</div>
      <%= form.fields_for :features do |features_form| %>
        <div class="form-toggle">
          <span class="toggle-label">USER REGISTRATION</span>
          <input type="checkbox" name="settings[features][user_registration]" id="toggle_user_registration" value="true" <%= @features['user_registration'] == true ? 'checked' : '' %> class="toggle-checkbox">
        </div>
        <div class="form-toggle">
          <span class="toggle-label">PERSONAL ACCOUNTS</span>
          <input type="checkbox" name="settings[features][personal_accounts]" id="toggle_personal_accounts" value="true" <%= @features['personal_accounts'] == true ? 'checked' : '' %> class="toggle-checkbox">
        </div>
      <% end %>
    </section>

    <div class="actions">
      <%= link_to "CANCEL", main_app.root_path, class: "btn" %>
      <%= link_to "RESET", boilermaker.edit_settings_path, class: "btn" %>
      <button type="submit" class="btn btn-primary" data-server-status-target="submitButton">SAVE CHANGES</button>
    </div>
  <% end %>
</div>
