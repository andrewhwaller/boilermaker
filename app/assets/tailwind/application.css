@import "tailwindcss";
@import "./themes.css";
@import "./theme_variations.css";
@import "./overlays.css";

/* ============================================
   TAILWIND THEME EXTENSION
   Maps CSS variables to Tailwind utilities
   ============================================ */
@theme {
  /* Font families - uses --app-font-family set by application_helper */
  --font-family-sans: var(--app-font-family, "CommitMonoIndustrial", monospace);
  --font-family-mono: var(--app-font-family, "CommitMonoIndustrial", monospace);

  /* Surface colors (backgrounds) */
  --color-surface: var(--bg);
  --color-surface-alt: var(--bg-alt);
  --color-inverse: var(--bg-inverse);

  /* Text colors */
  --color-body: var(--text);
  --color-muted: var(--text-muted);

  /* Accent colors */
  --color-accent: var(--accent);
  --color-accent-alt: var(--accent-alt);

  /* Border colors */
  --color-border-default: var(--border);
  --color-border-light: var(--border-light);

  /* Interactive states */
  --color-hover: var(--hover-bg);

  /* Semantic aliases for backwards compatibility */
  --color-background: var(--bg);
  --color-foreground: var(--text);
  --color-primary: var(--accent);
  --color-primary-foreground: var(--bg);
  --color-secondary: var(--bg-alt);
  --color-secondary-foreground: var(--text);
  --color-destructive: #dc2626;
  --color-destructive-foreground: #ffffff;
  --color-success: var(--accent-alt);
  --color-success-foreground: var(--bg);
  --color-warning: #f59e0b;
  --color-warning-foreground: #000000;
  --color-info: var(--accent);
  --color-info-foreground: var(--bg);
  --color-card: var(--bg-alt);
  --color-card-foreground: var(--text);
  --color-popover: var(--bg-alt);
  --color-popover-foreground: var(--text);
  --color-border: var(--border);
  --color-input: var(--bg);
  --color-ring: var(--accent);
}

/* ============================================
   BASE LAYER
   Global styles and typography
   ============================================ */
@layer base {
  :root {
    --app-text-transform: uppercase;
    --app-font-scale: 1;
    --theme-fx-duration: 200ms;
    --theme-fx-ease: cubic-bezier(0.6, 0, 1, 1);
    --radius: 0rem;
  }

  html {
    font-size: calc(14px * var(--app-font-scale, 1));
  }

  body {
    @apply bg-surface text-body;
    font-family: var(--app-font-family, "CommitMonoIndustrial", monospace);
  }

  h1 {
    font-size: calc(1.45rem * var(--app-font-scale, 1));
    line-height: 1.2;
    font-weight: 600;
    color: var(--text);
    margin: 0;
  }

  h2 {
    font-size: calc(1.25rem * var(--app-font-scale, 1));
    line-height: 1.25;
    font-weight: 600;
    color: var(--text);
    margin: 0;
  }

  h3 {
    font-size: calc(1.08rem * var(--app-font-scale, 1));
    line-height: 1.3;
    font-weight: 600;
    color: var(--text);
    margin: 0;
  }

  h4, h5, h6 {
    font-size: calc(1.0rem * var(--app-font-scale, 1));
    line-height: 1.35;
    font-weight: 600;
    color: var(--text);
    margin: 0;
  }

  a {
    color: var(--accent);
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  /* Theme transitions */
  .theme-transition,
  .theme-transition * {
    transition-property: color, background-color, border-color, outline-color,
      fill, stroke, text-decoration-color, caret-color;
    transition-duration: var(--theme-fx-duration);
    transition-timing-function: var(--theme-fx-ease);
    transition-delay: 0ms;
  }

  .theme-transition *:hover,
  .theme-transition *:focus,
  .theme-transition *:focus-visible,
  .theme-transition *:active {
    transition-duration: 150ms;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }

  @media (prefers-reduced-motion: reduce) {
    .theme-transition,
    .theme-transition * {
      transition: none !important;
    }
  }

  *:focus-visible {
    outline: 2px solid var(--accent) !important;
    outline-offset: 2px !important;
  }

  /* Blackbox theme: use browser default focus (removes Tailwind ring, keeps native outline) */
  [data-theme="blackbox"] *:focus-visible {
    outline: revert !important;
    outline-offset: revert !important;
    box-shadow: none !important;
  }
}

/* ============================================
   COMPONENT LAYER
   Reusable UI affordances with ui-* namespace
   See: https://x.com/fractaledmind/status/2004145607116804340
   ============================================ */
@layer components {
  /* Button base */
  .ui-button {
    @apply inline-flex items-center justify-center text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
  }

  .ui-button-primary {
    @apply bg-accent text-inverse border border-accent;
  }
  .ui-button-primary:hover {
    @apply bg-inverse text-surface border-inverse;
  }

  .ui-button-secondary {
    @apply bg-surface-alt text-body border border-border-default;
  }
  .ui-button-secondary:hover {
    @apply bg-inverse text-surface border-inverse;
  }

  .ui-button-outline {
    @apply bg-transparent text-body border border-border-default;
  }
  .ui-button-outline:hover {
    @apply bg-inverse text-surface border-inverse;
  }

  .ui-button-ghost {
    @apply bg-transparent text-body border-transparent;
  }
  .ui-button-ghost:hover {
    @apply bg-surface-alt text-body;
  }

  .ui-button-link {
    @apply bg-transparent text-accent underline-offset-4 border-transparent;
  }
  .ui-button-link:hover {
    @apply underline;
  }

  /* Button semantic variants */
  .ui-button-error {
    @apply bg-destructive text-destructive-foreground border-destructive;
  }
  .ui-button-error:hover {
    @apply opacity-90;
  }

  .ui-button-success {
    @apply bg-accent-alt text-inverse border-accent-alt;
  }
  .ui-button-success:hover {
    @apply opacity-90;
  }

  .ui-button-warning {
    @apply bg-warning text-warning-foreground border-warning;
  }
  .ui-button-warning:hover {
    @apply opacity-90;
  }

  .ui-button-info {
    @apply bg-accent text-inverse border-accent;
  }
  .ui-button-info:hover {
    @apply opacity-90;
  }

  /* Button sizes */
  .ui-button-lg {
    @apply h-12 min-h-12 px-6 text-base;
  }

  .ui-button-md {
    @apply h-10 min-h-10 px-4 text-sm;
  }

  .ui-button-sm {
    @apply h-8 min-h-8 px-3 text-xs;
  }

  .ui-button-xs {
    @apply h-6 min-h-6 px-2 text-xs;
  }

  /* Alert */
  .ui-alert {
    @apply relative w-full border border-border-default bg-surface p-4;
    border-radius: var(--radius);
  }

  .ui-alert-primary,
  .ui-alert-info {
    @apply border-accent/50 text-accent [&>svg]:text-accent;
  }

  .ui-alert-secondary {
    @apply border-border-light text-muted [&>svg]:text-muted;
  }

  .ui-alert-destructive {
    @apply border-destructive/50 text-destructive [&>svg]:text-destructive;
  }

  .ui-alert-success {
    @apply border-accent-alt/50 text-accent-alt [&>svg]:text-accent-alt;
  }

  .ui-alert-warning {
    @apply border-warning/50 text-warning [&>svg]:text-warning;
  }

  /* Badge */
  .ui-badge {
    @apply inline-flex items-center border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2;
    border-radius: var(--radius);
  }

  .ui-badge-primary {
    @apply border-transparent bg-accent text-inverse;
  }
  .ui-badge-primary:hover {
    @apply opacity-80;
  }

  .ui-badge-secondary {
    @apply border-transparent bg-surface-alt text-body;
  }
  .ui-badge-secondary:hover {
    @apply opacity-80;
  }

  .ui-badge-destructive,
  .ui-badge-error {
    @apply border-transparent bg-destructive text-destructive-foreground;
  }

  .ui-badge-success {
    @apply border-transparent bg-accent-alt text-inverse;
  }

  .ui-badge-warning {
    @apply border-transparent bg-warning text-warning-foreground;
  }

  .ui-badge-info {
    @apply border-transparent bg-accent text-inverse;
  }

  .ui-badge-accent {
    @apply border-transparent bg-accent text-inverse;
  }

  .ui-badge-neutral {
    @apply border-transparent bg-surface-alt text-muted;
  }

  .ui-badge-outline {
    @apply border-border-default bg-transparent text-body;
  }

  /* Card */
  .ui-card {
    @apply border border-border-default bg-surface-alt text-body;
    border-radius: var(--radius);
  }

  .ui-card-header {
    @apply px-6 py-4 border-b border-border-light;
  }

  .ui-card-content {
    @apply px-6 py-4;
  }

  .ui-card-header-primary { @apply border-b border-accent/20 bg-accent/10 text-accent; }
  .ui-card-header-secondary { @apply border-b border-border-light bg-surface-alt text-muted; }
  .ui-card-header-accent { @apply border-b border-accent/20 bg-accent/10 text-accent; }
  .ui-card-header-destructive { @apply border-b border-destructive/20 bg-destructive/10 text-destructive; }
  .ui-card-header-success { @apply border-b border-accent-alt/20 bg-accent-alt/10 text-accent-alt; }
  .ui-card-header-warning { @apply border-b border-warning/20 bg-warning/10 text-warning; }
  .ui-card-header-info { @apply border-b border-accent/20 bg-accent/10 text-accent; }

  /* Divider */
  .ui-divider {
    @apply border-b my-4 border-border-light;
  }

  /* Form controls */
  .ui-input, .ui-textarea, .ui-select {
    @apply block w-full border border-border-default bg-surface px-3 py-2 text-sm text-body placeholder:text-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50;
    border-radius: var(--radius);
  }

  .ui-checkbox {
    @apply h-4 w-4 shrink-0 border border-border-default focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50;
    border-radius: var(--radius);
  }

  .ui-radio {
    @apply h-4 w-4 shrink-0 rounded-full border border-border-default focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50;
  }

  /* Form error states */
  .ui-input-error,
  .ui-textarea-error,
  .ui-select-error,
  .ui-checkbox-error,
  .ui-radio-error {
    @apply border-destructive;
  }

  /* Dropdown */
  .ui-dropdown {
    @apply relative inline-block;
  }

  .ui-dropdown-content {
    @apply absolute hidden bg-surface-alt border border-border-default shadow-md z-50 w-48 p-2;
    border-radius: var(--radius);
  }

  .ui-dropdown:hover .ui-dropdown-content,
  .ui-dropdown:focus-within .ui-dropdown-content {
    @apply block;
  }

  .ui-dropdown-end .ui-dropdown-content { @apply right-0; }
  .ui-dropdown-top .ui-dropdown-content { @apply bottom-full; }
  .ui-dropdown-bottom .ui-dropdown-content { @apply top-full; }
  .ui-dropdown-start .ui-dropdown-content { @apply left-0; }

  /* Menu */
  .ui-menu {
    @apply py-1;
  }

  .ui-menu-item {
    @apply px-4 py-2 cursor-pointer text-body;
  }
  .ui-menu-item:hover {
    @apply bg-surface-alt text-accent;
  }

  /* Table */
  .ui-table {
    @apply w-full border-collapse text-sm;
  }

  .ui-table th {
    @apply text-left px-4 py-3 text-xs uppercase tracking-wide text-muted border-b border-border-default bg-surface-alt font-semibold;
  }

  .ui-table td {
    @apply px-4 py-3 border-b border-border-light;
  }

  .ui-table tr:hover {
    @apply bg-surface-alt;
  }

  /* Section header pattern from mockups */
  .ui-section-header {
    @apply flex justify-between items-center pb-2 border-b border-border-light mb-3;
  }

  .ui-section-title {
    @apply text-xs uppercase tracking-wider text-muted;
  }

  .ui-section-action {
    @apply text-xs text-accent;
  }
  .ui-section-action:hover {
    @apply underline;
  }

  /* Demo-specific patterns */
  .demo-row-hover:hover {
    background-color: var(--hover-bg);
  }

  .demo-table-th {
    @apply text-left px-2.5 py-2 text-[9px] uppercase tracking-[0.06em] text-accent font-semibold border-b-2 border-accent bg-surface-alt;
  }

  .demo-label {
    @apply text-[10px] uppercase tracking-[0.08em] text-muted;
  }

  .demo-label-wide {
    @apply text-[10px] uppercase tracking-[0.1em] text-muted;
  }
}

/* ============================================
   FONT FACE
   ============================================ */
@font-face {
  font-family: "CommitMonoIndustrial";
  src: url("/fonts/CommitMono VariableFont.woff2") format("woff2");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
  font-feature-settings: "ss01", "ss02", "ss03", "ss04", "ss05", "cv06", "cv09", "cv10", "cv11";
}

/* ============================================
   ANIMATIONS
   ASCII loading spinners
   ============================================ */
@keyframes ascii-dots-animation {
  0% { content: "⠋"; }
  10% { content: "⠙"; }
  20% { content: "⠹"; }
  30% { content: "⠸"; }
  40% { content: "⠼"; }
  50% { content: "⠴"; }
  60% { content: "⠦"; }
  70% { content: "⠧"; }
  80% { content: "⠇"; }
  90% { content: "⠏"; }
}

@keyframes ascii-spinner-animation {
  0% { content: "|"; }
  25% { content: "/"; }
  50% { content: "−"; }
  75% { content: "\\"; }
  100% { content: "|"; }
}

@keyframes ascii-pulse-animation {
  0% { content: "◐"; }
  11.1% { content: "◓"; }
  22.2% { content: "◑"; }
  33.3% { content: "◒"; }
  44.4% { content: "◐"; }
  55.5% { content: "◓"; }
  66.6% { content: "◑"; }
  77.7% { content: "◒"; }
  88.8% { content: "◐"; }
}

.loading-ascii::before {
  font-family: monospace;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
}

.loading-ascii.ascii-dots::before {
  content: "⠋";
  animation-name: ascii-dots-animation;
  animation-duration: 0.8s;
}

.loading-ascii.ascii-spinner::before {
  content: "|";
  animation-name: ascii-spinner-animation;
  animation-duration: 0.6s;
}

.loading-ascii.ascii-pulse::before {
  content: "◐";
  animation-name: ascii-pulse-animation;
  animation-duration: 0.6s;
}
