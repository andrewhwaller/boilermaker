# Plan Data Models

## Metadata
```yaml
id: subscription-plans-001
title: Plan Data Models
epic: subscription-plans
status: todo
priority: high
effort_estimate: 12
created_at: 2025-08-30T15:52:27Z
updated_at: 2025-08-30T15:52:27Z
assignee: null
tags: [models, database, flipper]
dependencies: []
parallel: false
```

## Description

Create the foundational data models for subscription plans and user plan assignments. This includes Plan and UserPlan models with proper database schema, validations, and integration with Flipper for feature flag management.

## Acceptance Criteria

- [ ] Plan model with fields: name, slug, price_cents, currency, billing_interval, feature_limits (JSON), description, active, created_at, updated_at
- [ ] UserPlan model with fields: user_id, plan_id, status, started_at, ends_at, created_at, updated_at
- [ ] Database migrations for both models with proper indexes
- [ ] Model validations and relationships (User belongs_to Plan through UserPlan)
- [ ] Flipper integration to automatically enable/disable features based on plan
- [ ] Plan.feature_enabled?(feature_name) method
- [ ] UserPlan status enum: active, cancelled, expired, pending
- [ ] Seed data for basic plans (free, pro, enterprise)

## Technical Notes

- Use Rails STI if multiple plan types are needed
- Feature limits should be stored as JSON with keys like: max_projects, max_users, api_calls_per_month
- Consider using ActiveRecord enums for status fields
- Add database constraints for data integrity
- Plan slugs should be unique and URL-friendly

## Definition of Done

- All models pass validation tests
- Database schema is properly indexed
- Flipper integration works correctly
- Seed data creates functional plans
- Model relationships are correctly defined
- Feature access methods return expected results

## Risk Assessment

**Risk Level: Medium**
- Database design changes are costly to modify later
- Flipper integration complexity
- Need to handle edge cases for plan transitions

## Notes

Foundation for entire subscription system. Design decisions here impact all subsequent tasks.